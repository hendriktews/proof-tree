## 
## prooftree --- proof tree display for Proof General
## 
## Copyright (C) 2011 Hendrik Tews
## 
## This file is part of "prooftree".
## 
## "prooftree" is free software: you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
## 
## "prooftree" is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
## General Public License in file COPYING in this or one of the parent
## directories for more details.
## 
## You should have received a copy of the GNU General Public License
## along with "prooftree". If not, see <http://www.gnu.org/licenses/>.
## 
## $Id: Makefile.in,v 1.7 2011/07/21 20:21:43 tews Exp $
## 
## Commentary: Makefile
## 

#############################################################################
##
## CONFIGURATION SECTION
##
#############################################################################

# The following variables are normally set by the configure script. 
# If this fails for some reason you can also rename Makefile.in to Makefile
# and set these variables manually.

# BINDIR: Directory where binaries are to be instelled. 
BINDIR=@BINDIR@

# MANDIR: Directory where the man page is to be installed.
MANDIR=@MANDIR@

# Should be ``prooftree.opt'' if you have ocamlopt.opt available.
# Should be ``prooftree.byte'' if you only have ocamlc.
prooftree: @PROOFTREE@


#############################################################################
##
## END OF CONFIGURATION SECTION
##
#############################################################################

.PHONY: all
all: prooftree

SOURCES:=\
	version.mli \
	version.ml \
	util.ml \
	configuration.ml \
	gtk_ext.ml \
	draw_tree.ml \
	about_window.ml \
	node_window.ml \
	proof_window.ml \
	proof_tree.mli \
	proof_tree.ml \
	input.mli \
	input.ml \
	main.ml

TOCLEAN+=prooftree

.PHONY: prooftree.opt
prooftree.opt: $(SOURCES)
	ocamlopt.opt -g -I +lablgtk2 -o prooftree \
		unix.cmxa lablgtk.cmxa \
		gtkInit.cmx $(SOURCES)

.PHONY: prooftree.byte
prooftree.byte: $(SOURCES)
	ocamlc -g -I +lablgtk2 -o prooftree \
		unix.cma lablgtk.cma \
		gtkInit.cmo $(SOURCES)

version.ml: version.txt
	echo '(* This file is automatically generated from version. *)' > $@
	echo '(* DO NOT EDIT! *)' >> $@
	echo "let version = \"`head -1 version.txt`\"" >> $@

.PHONY: install
install:
	mkdir -p ${BINDIR}
	cp prooftree ${BINDIR}

.PHONY: doc
doc: $(SOURCES)
	rm -rf doc
	mkdir doc
	ocamldoc.opt -I `ocamlc -where`/lablgtk2 -html -d doc \
		-inv-merge-ml-mli -m A $(SOURCES)
	ocamldoc.opt -I `ocamlc -where`/lablgtk2 -dot -o doc/dependencies.dot \
		-inv-merge-ml-mli -m A $(SOURCES)
	dot -Tps < doc/dependencies.dot > doc/dependencies.ps

clean:
	rm -f $(TOCLEAN)
	rm -f *.cmi *.cmo *.cmx *.o *.cma *.cmxa *.a

TAGS: $(SOURCES)
	otags $(SOURCES)
